@page
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]
@model WalletIndexModel
@{
    ViewData["Title"] = "My Wallet";
}

<div class="page-container">
    <div class="page-header">
        <h1 class="page-title">
            <i class="bi bi-wallet2"></i> My Wallet
        </h1>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert-minimal alert-minimal-success mb-4">
            <i class="bi bi-check-circle-fill"></i>
            <div>@TempData["SuccessMessage"]</div>
        </div>
    }

    <!-- Wallet Balance & Stats -->
    <div class="grid-minimal grid-minimal-2 mb-5">
        <!-- Wallet Balance Card -->
        <div class="card-minimal">
            <div class="card-minimal-header">
                <h2 class="card-minimal-title">
                    <i class="bi bi-wallet2"></i> Current Balance
                </h2>
            </div>
            <div style="text-align: center; padding: var(--space-4) 0;">
                <div style="font-size: 3rem; font-weight: 700; color: var(--sage-primary); margin-bottom: var(--space-4);">
                    ₱@Model.WalletBalance.ToString("F2")
                </div>
                <div class="btn-group-premium" style="justify-content: center;">
                    <a href="/Wallet/Load" class="btn-minimal btn-minimal-primary">
                        <i class="bi bi-plus-circle"></i> Load Wallet
                    </a>
                    <a href="/Wallet/Withdraw" class="btn-minimal btn-minimal-outline">
                        <i class="bi bi-dash-circle"></i> Withdraw
                    </a>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="grid-minimal grid-minimal-2" style="gap: var(--space-3);">
            <div class="stat-card-minimal">
                <div class="stat-icon stat-icon-success">
                    <i class="bi bi-arrow-down-circle"></i>
                </div>
                <div class="stat-value">₱@Model.TotalLoaded.ToString("F0")</div>
                <div class="stat-label">Total Loaded</div>
            </div>
            <div class="stat-card-minimal">
                <div class="stat-icon stat-icon-warning">
                    <i class="bi bi-arrow-up-circle"></i>
                </div>
                <div class="stat-value">₱@Model.TotalSpent.ToString("F0")</div>
                <div class="stat-label">Total Spent</div>
            </div>
        </div>
    </div>

    <!-- Transaction History -->
    <div class="card-minimal">
        <div class="card-minimal-header">
            <h2 class="card-minimal-title">
                <i class="bi bi-clock-history"></i> Transaction History
            </h2>
        </div>
        @if (Model.Transactions.Any())
        {
            <div style="overflow-x: auto;">
                <table class="table-minimal">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th style="text-align: right;">Amount</th>
                            <th style="text-align: right;">Balance</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var transaction in Model.Transactions)
                        {
                            <tr>
                                <td>@transaction.CreatedAt.ToString("MMM dd, yyyy hh:mm tt")</td>
                                <td>
                                    <span class="badge-minimal @(transaction.Amount > 0 ? "badge-minimal-success" : "badge-minimal-danger")">
                                        @transaction.TransactionType.TypeName
                                    </span>
                                </td>
                                <td>@transaction.Description</td>
                                <td style="text-align: right;">
                                    <span style="color: @(transaction.Amount > 0 ? "var(--success)" : "var(--error)"); font-weight: 600;">
                                        @(transaction.Amount > 0 ? "+" : "")₱@Math.Abs(transaction.Amount).ToString("F2")
                                    </span>
                                </td>
                                <td style="text-align: right; font-weight: 600;">₱@transaction.BalanceAfter.ToString("F2")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            @if (Model.TotalPages > 1)
            {
                <nav class="pagination-premium" style="margin-top: var(--space-6);">
                    <ul class="pagination">
                        @for (int i = 1; i <= Model.TotalPages; i++)
                        {
                            <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                                <a class="page-link" href="?page=@i">@i</a>
                            </li>
                        }
                    </ul>
                </nav>
            }
        }
        else
        {
            <div class="empty-state-premium">
                <div class="empty-icon">
                    <i class="bi bi-wallet2"></i>
                </div>
                <h3>No Transactions Yet</h3>
                <p>Your transaction history will appear here once you start using your wallet.</p>
                <a href="/Wallet/Load" class="btn-minimal btn-minimal-primary">
                    <i class="bi bi-plus-circle"></i> Load Wallet
                </a>
            </div>
        }
    </div>
</div>
