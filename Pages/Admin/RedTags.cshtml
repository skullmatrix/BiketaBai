@page
@using Microsoft.AspNetCore.Authorization
@using BiketaBai.Helpers
@using BiketaBai.Services
@attribute [Authorize]
@model RedTagsModel
@{
    ViewData["Title"] = "Red Tags Management";
}

<link rel="stylesheet" href="~/css/premium-minimal.css" asp-append-version="true" />

<div class="page-container">
    <div style="max-width: 1400px; margin: 0 auto; padding: var(--space-4);">
        <!-- Header -->
        <div class="page-header" style="margin-bottom: var(--space-5);">
            <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: var(--space-4);">
                <div>
                    <h1 class="page-title">
                        <i class="bi bi-flag-fill" style="color: var(--danger);"></i> Red Tags Management
                    </h1>
                    <p class="page-subtitle">View and manage red-tagged renters. Resolve red tags to restore account access.</p>
                </div>
                <div style="display: flex; gap: var(--space-2); flex-wrap: wrap;">
                    <a href="/Admin/Flags" class="btn-minimal btn-minimal-outline">
                        <i class="bi bi-flag"></i> View Flags
                    </a>
                    <a href="/Admin/Dashboard" class="btn-minimal btn-minimal-ghost">
                        <i class="bi bi-arrow-left"></i> Back to Dashboard
                    </a>
                </div>
            </div>
        </div>

        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert-minimal alert-minimal-success mb-4">
                <i class="bi bi-check-circle-fill"></i>
                <div>@TempData["SuccessMessage"]</div>
            </div>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert-minimal alert-minimal-error mb-4">
                <i class="bi bi-exclamation-triangle-fill"></i>
                <div>@TempData["ErrorMessage"]</div>
            </div>
        }

        <!-- Summary Cards -->
        <div class="grid-minimal grid-minimal-3 mb-5">
            <div class="stat-card-minimal" style="border-left: 4px solid var(--danger); background: linear-gradient(135deg, #FEE2E2 0%, #FEF2F2 100%);">
                <div class="stat-icon" style="background: linear-gradient(135deg, #DC2626 0%, #991B1B 100%); color: white; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);">
                    <i class="bi bi-flag-fill"></i>
                </div>
                <div class="stat-value" style="color: var(--danger);">@Model.ActiveRedTags.Count</div>
                <div class="stat-label" style="font-weight: 600;">Active Red Tags</div>
                <div style="font-size: 0.75rem; color: var(--neutral-600); margin-top: var(--space-2); display: flex; align-items: center; gap: var(--space-1);">
                    <i class="bi bi-person-x-fill" style="color: var(--danger);"></i>
                    <span>Renters currently blocked</span>
                </div>
            </div>
            <div class="stat-card-minimal" style="border-left: 4px solid var(--success); background: linear-gradient(135deg, #D1FAE5 0%, #ECFDF5 100%);">
                <div class="stat-icon stat-icon-success" style="background: linear-gradient(135deg, #10B981 0%, #059669 100%); color: white; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
                    <i class="bi bi-check-circle-fill"></i>
                </div>
                <div class="stat-value" style="color: var(--success);">@Model.ResolvedRedTags.Count</div>
                <div class="stat-label" style="font-weight: 600;">Resolved Red Tags</div>
                <div style="font-size: 0.75rem; color: var(--neutral-600); margin-top: var(--space-2); display: flex; align-items: center; gap: var(--space-1);">
                    <i class="bi bi-check-circle" style="color: var(--success);"></i>
                    <span>Previously resolved</span>
                </div>
            </div>
            <div class="stat-card-minimal" style="border-left: 4px solid var(--neutral-400); background: linear-gradient(135deg, #F3F4F6 0%, #F9FAFB 100%);">
                <div class="stat-icon" style="background: linear-gradient(135deg, #6B7280 0%, #4B5563 100%); color: white; box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);">
                    <i class="bi bi-list-ul"></i>
                </div>
                <div class="stat-value" style="color: var(--neutral-700);">@(Model.ActiveRedTags.Count + Model.ResolvedRedTags.Count)</div>
                <div class="stat-label" style="font-weight: 600;">Total Red Tags</div>
                <div style="font-size: 0.75rem; color: var(--neutral-600); margin-top: var(--space-2); display: flex; align-items: center; gap: var(--space-1);">
                    <i class="bi bi-clock-history" style="color: var(--neutral-500);"></i>
                    <span>All time</span>
                </div>
            </div>
        </div>

        <!-- Filter Tabs -->
        <div class="card-minimal mb-4" style="background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
            <div style="display: flex; gap: var(--space-2); padding: var(--space-3); border-radius: var(--radius-md);">
                <a href="?filter=active" 
                   class="btn-minimal @(Model.Filter == "active" ? "btn-minimal-danger" : "btn-minimal-ghost")" 
                   style="text-decoration: none; flex: 1; justify-content: center; font-weight: 600; padding: var(--space-3); border-radius: var(--radius-md); transition: all 0.3s ease; @(Model.Filter == "active" ? "box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2);" : "")">
                    <i class="bi bi-flag-fill"></i> Active 
                    <span class="badge-minimal badge-minimal-danger" style="margin-left: var(--space-2); font-size: 0.875rem;">@Model.ActiveRedTags.Count</span>
                </a>
                <a href="?filter=resolved" 
                   class="btn-minimal @(Model.Filter == "resolved" ? "btn-minimal-success" : "btn-minimal-ghost")" 
                   style="text-decoration: none; flex: 1; justify-content: center; font-weight: 600; padding: var(--space-3); border-radius: var(--radius-md); transition: all 0.3s ease; @(Model.Filter == "resolved" ? "box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);" : "")">
                    <i class="bi bi-check-circle"></i> Resolved 
                    <span class="badge-minimal badge-minimal-success" style="margin-left: var(--space-2); font-size: 0.875rem;">@Model.ResolvedRedTags.Count</span>
                </a>
            </div>
        </div>

        <!-- Red Tags List -->
        @if (!Model.RedTags.Any())
        {
            <div class="card-minimal">
                <div style="text-align: center; padding: var(--space-5);">
                    <i class="bi bi-inbox" style="font-size: 3rem; color: var(--neutral-400); margin-bottom: var(--space-3);"></i>
                    <p style="color: var(--neutral-600); font-size: 1.125rem;">No @(Model.Filter == "active" ? "active" : "resolved") red tags found.</p>
                </div>
            </div>
        }
        else
        {
            @foreach (var redTag in Model.RedTags)
            {
                <div class="card-minimal mb-4" style="border-left: 5px solid @(redTag.IsActive ? "var(--danger)" : "var(--success)"); box-shadow: 0 4px 12px rgba(0,0,0,0.08); transition: all 0.3s ease; @(redTag.IsActive ? "background: linear-gradient(135deg, #FEF2F2 0%, #FFFFFF 100%);" : "background: linear-gradient(135deg, #ECFDF5 0%, #FFFFFF 100%);")">
                    <div class="card-minimal-header" style="padding: var(--space-4); border-bottom: 1px solid var(--neutral-200);">
                        <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: var(--space-3);">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-2);">
                                    <div style="width: 48px; height: 48px; border-radius: 50%; background: @(redTag.IsActive ? "linear-gradient(135deg, #DC2626 0%, #991B1B 100%)" : "linear-gradient(135deg, #10B981 0%, #059669 100%)"); display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px @(redTag.IsActive ? "rgba(220, 38, 38, 0.3)" : "rgba(16, 185, 129, 0.3)");">
                                        <i class="bi bi-flag-fill" style="color: white; font-size: 1.25rem;"></i>
                                    </div>
                                    <div>
                                        <h2 class="card-minimal-title" style="font-size: 1.25rem; margin: 0; font-weight: 700; color: var(--neutral-900);">
                                            Red Tag #@redTag.RedTagId.ToString("D6")
                                        </h2>
                                        <div style="font-size: 0.875rem; color: var(--neutral-600); margin-top: var(--space-1); display: flex; align-items: center; gap: var(--space-2); flex-wrap: wrap;">
                                            <span class="badge-minimal @(redTag.IsActive ? "badge-minimal-danger" : "badge-minimal-success")" style="font-size: 0.8125rem; padding: 0.25rem 0.75rem; font-weight: 600;">
                                                @(redTag.IsActive ? "ðŸ”’ Account Blocked" : "âœ… Resolved")
                                            </span>
                                            <span style="display: flex; align-items: center; gap: var(--space-1);">
                                                <i class="bi bi-calendar-event" style="font-size: 0.75rem;"></i>
                                                <span>Issued @TimeZoneHelper.FormatPhilippineTime(redTag.CreatedAt, "MMM dd, yyyy 'at' hh:mm tt")</span>
                                            </span>
                                            @if (!redTag.IsActive && redTag.ResolvedAt.HasValue)
                                            {
                                                <span style="display: flex; align-items: center; gap: var(--space-1); color: var(--success);">
                                                    <i class="bi bi-check-circle-fill" style="font-size: 0.75rem;"></i>
                                                    <span>Resolved @TimeZoneHelper.FormatPhilippineTime(redTag.ResolvedAt.Value, "MMM dd, yyyy")</span>
                                                </span>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @if (redTag.IsActive)
                            {
                                <div style="display: flex; gap: var(--space-2); flex-wrap: wrap;">
                                    <button type="button" 
                                            class="btn-minimal btn-minimal-success resolve-red-tag-btn" 
                                            data-red-tag-id="@redTag.RedTagId"
                                            data-renter-name="@redTag.Renter?.FullName"
                                            style="font-weight: 600; padding: var(--space-3) var(--space-4); box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); transition: all 0.3s ease;">
                                        <i class="bi bi-check-circle-fill"></i> Resolve & Restore Access
                                    </button>
                                </div>
                            }
                        </div>
                    </div>

                    <div style="padding: var(--space-4);">
                        <!-- Red Tag Details -->
                        <div class="grid-minimal grid-minimal-2 mb-4" style="gap: var(--space-4);">
                            <div style="padding: var(--space-3); background: var(--neutral-50); border-radius: var(--radius-md); border: 1px solid var(--neutral-200);">
                                <div style="font-size: 0.75rem; color: var(--neutral-500); margin-bottom: var(--space-1); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Renter</div>
                                <div style="font-weight: 700; margin-bottom: var(--space-2); color: var(--danger); font-size: 1.125rem;">
                                    <i class="bi bi-person-fill" style="margin-right: var(--space-1);"></i>@redTag.Renter?.FullName
                                </div>
                                <div style="font-size: 0.875rem; color: var(--neutral-600); display: flex; align-items: center; gap: var(--space-1);">
                                    <i class="bi bi-envelope" style="font-size: 0.75rem;"></i>
                                    <span>@redTag.Renter?.Email</span>
                                </div>
                                
                                <div style="margin-top: var(--space-3); padding-top: var(--space-3); border-top: 1px solid var(--neutral-200);">
                                    <div style="font-size: 0.75rem; color: var(--neutral-500); margin-bottom: var(--space-1); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Flagged By</div>
                                    <div style="font-weight: 600; color: var(--neutral-900);">
                                        <i class="bi bi-shield-exclamation" style="margin-right: var(--space-1); color: var(--warning);"></i>@redTag.Owner?.FullName
                                    </div>
                                </div>
                            </div>
                            <div style="padding: var(--space-3); background: var(--neutral-50); border-radius: var(--radius-md); border: 1px solid var(--neutral-200);">
                                @if (redTag.BookingId.HasValue && redTag.Booking != null)
                                {
                                    <div style="font-size: 0.75rem; color: var(--neutral-500); margin-bottom: var(--space-1); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Booking</div>
                                    <div style="font-weight: 600; margin-bottom: var(--space-2);">
                                        <a href="/Bookings/Details/@redTag.BookingId" class="text-sage" style="font-size: 1.125rem; text-decoration: none; display: flex; align-items: center; gap: var(--space-1);">
                                            <i class="bi bi-calendar-check"></i>
                                            <span>Booking #@redTag.BookingId.Value.ToString("D6")</span>
                                        </a>
                                        @if (redTag.Booking.Bike != null)
                                        {
                                            <div style="font-size: 0.875rem; color: var(--neutral-600); margin-top: var(--space-1); display: flex; align-items: center; gap: var(--space-1);">
                                                <i class="bi bi-bicycle" style="font-size: 0.75rem;"></i>
                                                <span>@redTag.Booking.Bike.Brand @redTag.Booking.Bike.Model</span>
                                            </div>
                                        }
                                    </div>
                                    <div style="margin-top: var(--space-3); padding-top: var(--space-3); border-top: 1px solid var(--neutral-200);">
                                        <div style="font-size: 0.75rem; color: var(--neutral-500); margin-bottom: var(--space-1); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Reason</div>
                                        <div style="font-weight: 700; color: var(--warning); font-size: 1.125rem;">
                                            <i class="bi bi-exclamation-triangle-fill" style="margin-right: var(--space-1);"></i>@redTag.RedTagReason
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div style="font-size: 0.75rem; color: var(--neutral-500); margin-bottom: var(--space-1); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Reason</div>
                                    <div style="font-weight: 700; color: var(--warning); font-size: 1.125rem;">
                                        <i class="bi bi-exclamation-triangle-fill" style="margin-right: var(--space-1);"></i>@redTag.RedTagReason
                                    </div>
                                }
                            </div>
                        </div>

                        @if (!string.IsNullOrEmpty(redTag.RedTagDescription))
                        {
                            <div style="padding: var(--space-4); background: linear-gradient(135deg, #FFFBF0 0%, #FFFBEB 100%); border-left: 4px solid var(--warning); border-radius: var(--radius-md); margin-bottom: var(--space-4); box-shadow: 0 2px 8px rgba(245, 158, 11, 0.1);">
                                <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-2);">
                                    <i class="bi bi-file-text-fill" style="color: var(--warning); font-size: 1.25rem;"></i>
                                    <div style="font-size: 0.875rem; color: var(--neutral-600); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Description</div>
                                </div>
                                <p style="margin: 0; font-weight: 500; color: var(--neutral-800); line-height: 1.7;">@redTag.RedTagDescription</p>
                            </div>
                        }

                        @if (!redTag.IsActive && redTag.Resolver != null)
                        {
                            <div style="padding: var(--space-3); background: var(--success-subtle); border-left: 3px solid var(--success); border-radius: var(--radius-md); margin-bottom: var(--space-3);">
                                <div style="font-size: 0.875rem; color: var(--neutral-600); margin-bottom: var(--space-1);">
                                    <i class="bi bi-check-circle-fill" style="color: var(--success);"></i> Resolved by
                                </div>
                                <div style="font-weight: 600; margin-bottom: var(--space-2);">@redTag.Resolver.FullName</div>
                                @if (!string.IsNullOrEmpty(redTag.ResolutionNotes))
                                {
                                    <div style="font-size: 0.875rem; color: var(--neutral-700);">
                                        <strong>Resolution Notes:</strong> @redTag.ResolutionNotes
                                    </div>
                                }
                            </div>
                        }

                        @if (redTag.IsActive)
                        {
                            <div style="padding: var(--space-4); background: linear-gradient(135deg, #FEE2E2 0%, #FEF2F2 100%); border-left: 4px solid var(--danger); border-radius: var(--radius-md); box-shadow: 0 2px 8px rgba(220, 38, 38, 0.15);">
                                <div style="display: flex; align-items: start; gap: var(--space-3);">
                                    <div style="width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, #DC2626 0%, #991B1B 100%); display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);">
                                        <i class="bi bi-lock-fill" style="color: white; font-size: 1.5rem;"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-2);">
                                            <strong style="color: var(--danger); font-size: 1.125rem; font-weight: 700;">Account Status: BLOCKED</strong>
                                            <span class="badge-minimal badge-minimal-danger" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;">ðŸ”’ Restricted</span>
                                        </div>
                                        <p style="margin: 0; font-size: 0.9375rem; color: #991B1B; line-height: 1.7;">
                                            This renter <strong>cannot log in</strong> to their account. They must contact the administrator to resolve this issue. Resolving this red tag will <strong>immediately restore</strong> their account access and allow them to make bookings again.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        }
    </div>
</div>

<!-- Resolve Red Tag Modal -->
<div class="modal fade" id="resolveRedTagModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content modal-premium" style="border-radius: var(--radius-lg); overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div class="modal-header-premium" style="background: linear-gradient(135deg, #10B981 0%, #059669 100%); padding: var(--space-5); border-bottom: none;">
                <div style="display: flex; align-items: center; gap: var(--space-3); width: 100%;">
                    <div style="width: 64px; height: 64px; border-radius: 50%; background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; border: 3px solid rgba(255, 255, 255, 0.3);">
                        <i class="bi bi-check-circle-fill" style="color: white; font-size: 2rem;"></i>
                    </div>
                    <div style="flex: 1;">
                        <h5 style="color: white; font-size: 1.5rem; font-weight: 700; margin: 0;">Resolve Red Tag</h5>
                        <p style="color: rgba(255, 255, 255, 0.9); margin: var(--space-1) 0 0 0; font-size: 0.875rem;">Restore account access for this renter</p>
                    </div>
                    <button type="button" class="btn-close-premium" data-bs-dismiss="modal" style="color: white; font-size: 1.5rem; background: rgba(255, 255, 255, 0.2); border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border: none; transition: all 0.3s ease;">Ã—</button>
                </div>
            </div>
            <div class="modal-body-premium" style="padding: var(--space-5);">
                <div id="resolveRedTagMessage" style="padding: var(--space-4); background: linear-gradient(135deg, var(--neutral-50) 0%, #F9FAFB 100%); border-radius: var(--radius-md); margin-bottom: var(--space-4); border: 1px solid var(--neutral-200);"></div>
                
                <div class="warning-box" style="background: linear-gradient(135deg, #D1FAE5 0%, #ECFDF5 100%); border-left: 4px solid var(--success); padding: var(--space-4); border-radius: var(--radius-md); margin-bottom: var(--space-4); box-shadow: 0 2px 8px rgba(16, 185, 129, 0.15);">
                    <div style="display: flex; align-items: start; gap: var(--space-3);">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #10B981 0%, #059669 100%); display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
                            <i class="bi bi-info-circle-fill" style="color: white; font-size: 1.25rem;"></i>
                        </div>
                        <div style="flex: 1;">
                            <strong style="color: var(--success); display: block; margin-bottom: var(--space-2); font-size: 1.0625rem;">Account Restoration</strong>
                            <p style="margin: 0; font-size: 0.9375rem; color: #065F46; line-height: 1.7;">
                                Resolving this red tag will <strong>immediately restore the renter's account access</strong>. They will be able to log in and make bookings again. A notification will be automatically sent to the renter informing them of the resolution.
                            </p>
                        </div>
                    </div>
                </div>
                
                <form method="post" asp-page-handler="Resolve">
                    <input type="hidden" asp-for="ResolveInput.RedTagId" id="resolveRedTagId" />
                    <div class="form-group-minimal mb-4">
                        <label for="resolutionNotes" class="form-label-minimal" style="font-weight: 600; font-size: 0.9375rem; margin-bottom: var(--space-2);">
                            <i class="bi bi-file-text-fill" style="margin-right: var(--space-1); color: var(--sage-primary);"></i> Resolution Notes (Optional)
                        </label>
                        <textarea asp-for="ResolveInput.ResolutionNotes" 
                                  id="resolutionNotes" 
                                  class="input-minimal" 
                                  rows="5" 
                                  style="font-size: 0.9375rem; padding: var(--space-3); border: 2px solid var(--neutral-200); border-radius: var(--radius-md); transition: all 0.3s ease;"
                                  placeholder="Optional: Add notes about why this red tag is being resolved, what actions were taken, or any other relevant information..."></textarea>
                        <small style="color: var(--neutral-600); font-size: 0.875rem; margin-top: var(--space-2); display: block; display: flex; align-items: center; gap: var(--space-1);">
                            <i class="bi bi-info-circle" style="font-size: 0.75rem;"></i>
                            <span>These notes will be visible in the red tag history and help track resolution details</span>
                        </small>
                    </div>
                    
                    <div class="d-flex justify-content-end gap-2 mt-5" style="padding-top: var(--space-4); border-top: 1px solid var(--neutral-200);">
                        <button type="button" class="btn-modal-cancel" data-bs-dismiss="modal" style="padding: var(--space-3) var(--space-4); font-weight: 600;">
                            <i class="bi bi-x-circle"></i> Cancel
                        </button>
                        <button type="submit" class="btn-modal-success" id="resolveSubmitBtn" style="padding: var(--space-3) var(--space-5); font-weight: 600; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
                            <i class="bi bi-check-circle-fill"></i> Resolve Red Tag & Restore Access
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function () {
            // Resolve Red Tag Modal
            $('.resolve-red-tag-btn').on('click', function() {
                const redTagId = $(this).data('red-tag-id');
                const renterName = $(this).data('renter-name');
                
                $('#resolveRedTagId').val(redTagId);
                $('#resolveRedTagMessage').html(`
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4);">
                        <div style="padding: var(--space-3); background: white; border-radius: var(--radius-md); border: 2px solid var(--neutral-200);">
                            <div style="font-size: 0.75rem; color: var(--neutral-500); margin-bottom: var(--space-1); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Red Tag ID</div>
                            <div style="font-weight: 700; color: var(--danger); font-size: 1.125rem; display: flex; align-items: center; gap: var(--space-1);">
                                <i class="bi bi-flag-fill"></i>
                                <span>#${redTagId.toString().padStart(6, '0')}</span>
                            </div>
                        </div>
                        <div style="padding: var(--space-3); background: white; border-radius: var(--radius-md); border: 2px solid var(--neutral-200);">
                            <div style="font-size: 0.75rem; color: var(--neutral-500); margin-bottom: var(--space-1); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Renter</div>
                            <div style="font-weight: 700; color: var(--danger); font-size: 1.125rem; display: flex; align-items: center; gap: var(--space-1);">
                                <i class="bi bi-person-fill"></i>
                                <span>${renterName}</span>
                            </div>
                        </div>
                    </div>
                `);
                
                // Reset form
                $('#resolutionNotes').val('');
                
                const modal = new bootstrap.Modal(document.getElementById('resolveRedTagModal'));
                modal.show();
            });
            
            // Form submission handler
            $('#resolveRedTagModal form').on('submit', function() {
                const submitBtn = $('#resolveSubmitBtn');
                submitBtn.html('<span class="spinner-border spinner-border-sm me-2"></span>Processing...').prop('disabled', true);
            });
        });
    </script>
}


