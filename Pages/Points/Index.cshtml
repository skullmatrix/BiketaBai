@page
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]
@model PointsIndexModel
@{
    ViewData["Title"] = "My Points";
}

<div class="page-container">
    <div class="page-header">
        <h1 class="page-title">
            <i class="bi bi-star-fill"></i> My Loyalty Points
        </h1>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert-minimal alert-minimal-success mb-4">
            <i class="bi bi-check-circle-fill"></i>
            <div>@TempData["SuccessMessage"]</div>
        </div>
    }

    <!-- Points Balance & Redeem -->
    <div class="grid-minimal grid-minimal-2 mb-5">
        <!-- Points Balance Card -->
        <div class="card-minimal" style="background: linear-gradient(135deg, #fff9e6 0%, #ffe6cc 100%); border: 2px solid #ffc107;">
            <div class="card-minimal-header">
                <h2 class="card-minimal-title">
                    <i class="bi bi-star-fill" style="color: #ff9800;"></i> Total Points
                </h2>
            </div>
            <div style="text-align: center; padding: var(--space-4) 0;">
                <div style="font-size: 3.5rem; font-weight: 700; color: #ff9800; margin-bottom: var(--space-2);">
                    @Model.PointsBalance
                </div>
                <p style="color: var(--neutral-600); margin: 0;">
                    ≈ ₱@((Model.PointsBalance * 0.1m).ToString("F2")) wallet credit
                </p>
            </div>
        </div>

        <!-- Redeem Options -->
        <div class="card-minimal">
            <div class="card-minimal-header">
                <h2 class="card-minimal-title">
                    <i class="bi bi-gift"></i> Redeem Points
                </h2>
            </div>
            <form method="post" asp-page-handler="Redeem">
                <div class="form-group-minimal">
                    <label class="label-minimal">Points to Redeem</label>
                    <input type="number" 
                           name="pointsToRedeem" 
                           class="input-minimal" 
                           min="100" 
                           step="100" 
                           max="@Model.PointsBalance" 
                           required 
                           placeholder="Minimum 100 points" />
                    <small style="font-size: 0.8125rem; color: var(--neutral-500); margin-top: var(--space-1); display: block;">
                        Minimum 100 points. 100 points = ₱10
                    </small>
                </div>
                <button type="submit" 
                        class="btn-minimal btn-minimal-primary w-100" 
                        @(Model.PointsBalance < 100 ? "disabled" : "")>
                    <i class="bi bi-gift"></i> Redeem for Wallet Credit
                </button>
            </form>
        </div>
    </div>

    <!-- How to Earn Points -->
    <div class="card-minimal mb-5">
        <div class="card-minimal-header">
            <h2 class="card-minimal-title">
                <i class="bi bi-lightbulb"></i> How to Earn Points
            </h2>
        </div>
        <div class="grid-minimal grid-minimal-2">
            <ul style="list-style: none; padding: 0; margin: 0;">
                <li style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-3);">
                    <i class="bi bi-check-circle-fill" style="color: var(--success); font-size: 1.25rem;"></i>
                    <div>
                        <strong>On-time Return:</strong> <span style="color: var(--sage-primary);">+10 points</span>
                    </div>
                </li>
                <li style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-3);">
                    <i class="bi bi-check-circle-fill" style="color: var(--success); font-size: 1.25rem;"></i>
                    <div>
                        <strong>Eco-commute:</strong> <span style="color: var(--sage-primary);">+1 point per km saved</span>
                    </div>
                </li>
                <li style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-3);">
                    <i class="bi bi-check-circle-fill" style="color: var(--success); font-size: 1.25rem;"></i>
                    <div>
                        <strong>First Rental:</strong> <span style="color: var(--sage-primary);">+50 points</span>
                    </div>
                </li>
            </ul>
            <ul style="list-style: none; padding: 0; margin: 0;">
                <li style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-3);">
                    <i class="bi bi-check-circle-fill" style="color: var(--success); font-size: 1.25rem;"></i>
                    <div>
                        <strong>Long-term Rental (7+ days):</strong> <span style="color: var(--sage-primary);">+20 points</span>
                    </div>
                </li>
                <li style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-3);">
                    <i class="bi bi-check-circle-fill" style="color: var(--success); font-size: 1.25rem;"></i>
                    <div>
                        <strong>5-Star Rating:</strong> <span style="color: var(--sage-primary);">+5 points</span>
                    </div>
                </li>
                <li style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-3);">
                    <i class="bi bi-check-circle-fill" style="color: var(--success); font-size: 1.25rem;"></i>
                    <div>
                        <strong>Referral:</strong> <span style="color: var(--sage-primary);">+100 points</span>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!-- Points History -->
    <div class="card-minimal">
        <div class="card-minimal-header">
            <h2 class="card-minimal-title">
                <i class="bi bi-clock-history"></i> Points History
            </h2>
        </div>
        @if (Model.PointsHistory.Any())
        {
            <div style="overflow-x: auto;">
                <table class="table-minimal">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Activity</th>
                            <th style="text-align: right;">Points</th>
                            <th style="text-align: right;">Balance</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var history in Model.PointsHistory)
                        {
                            <tr>
                                <td>@history.CreatedAt.ToString("MMM dd, yyyy hh:mm tt")</td>
                                <td>@history.Reason</td>
                                <td style="text-align: right;">
                                    <span style="color: @(history.PointsChange > 0 ? "var(--success)" : "var(--error)"); font-weight: 600;">
                                        @(history.PointsChange > 0 ? "+" : "")@history.PointsChange
                                    </span>
                                </td>
                                <td style="text-align: right; font-weight: 600;">@history.PointsAfter</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="empty-state-premium">
                <div class="empty-icon">
                    <i class="bi bi-star"></i>
                </div>
                <h3>No Points History Yet</h3>
                <p>Start renting to earn points! Your points history will appear here.</p>
                <a href="/Bikes/Browse" class="btn-minimal btn-minimal-primary">
                    <i class="bi bi-bicycle"></i> Browse Bikes
                </a>
            </div>
        }
    </div>
</div>
